<div style="text-align: center">
    <h1>BITRIX</h1>
</div>

## Event

<details>
<summary>Обработчик события `OnAfterIBlockElementUpdate`</summary>

Этот PHP-скрипт предназначен для обработки события `OnAfterIBlockElementUpdate` в системе управления контентом (CMS)
Bitrix. Событие срабатывает после обновления элемента инфоблока. Основная задача скрипта — извлечь изображения,
закодированные в формате Base64, из поля `DETAIL_TEXT`, сохранить их на сервере и заменить ссылки на эти изображения в
тексте на пути к сохраненным файлам.

### Основные функции

1. **Проверка инфоблока**: Скрипт работает только с элементами инфоблока с ID = 8 (например, инфоблок "Новости").
2. **Извлечение изображений**: Скрипт ищет в поле `DETAIL_TEXT` теги `<img>` с изображениями, закодированными в
   формате Base64.
3. **Сохранение изображений**: Изображения декодируются из Base64 и сохраняются на сервере в директории
   `upload/news/{ID элемента}/`.
4. **Обновление текста**: После сохранения изображений, ссылки на них в поле `DETAIL_TEXT` заменяются на пути к
   сохраненным файлам.
5. **Очистка старых изображений**: Скрипт удаляет изображения из директории, которые больше не упоминаются в поле
   `DETAIL_TEXT`.

### Как работает скрипт

1. **Инициализация**: Скрипт регистрирует обработчик события `OnAfterIBlockElementUpdate`, который вызывает функцию
   `myFunction` после обновления элемента инфоблока.
2. **Проверка инфоблока**: В функции `myFunction` проверяется, принадлежит ли обновленный элемент инфоблоку с ID = 8.
3. **Поиск изображений**: Если в поле `DETAIL_TEXT` найдены изображения в формате Base64, они извлекаются и
   сохраняются на сервере.
4. **Сохранение изображений**: Каждое изображение декодируется из Base64 и сохраняется в директории
   `upload/news/{ID элемента}/`. Имя файла генерируется с использованием `uniqid`.
5. **Обновление текста**: Ссылки на изображения в поле `DETAIL_TEXT` заменяются на пути к сохраненным файлам.
6. **Очистка старых изображений**: Скрипт проверяет директорию с изображениями и удаляет файлы, которые больше не
   упоминаются в поле `DETAIL_TEXT`.
7. **Обновление элемента**: После всех изменений элемент инфоблока обновляется с новым значением поля `DETAIL_TEXT`.

### Пример использования

```php
addEventHandler('iblock', 'OnAfterIBlockElementUpdate', 'myFunction');
```
</details>
<details>
  <summary>Обработчик события `NEXT`</summary>
</details>
